
---

# C# 编程指南

## 版权信息

© 2024. 未经许可不得复制、修改或分发。此文献为 [小風的藏書閣](https://t.me/xfp2333) 所有。

---

# 静态构造函数

静态构造函数是一个特殊的构造函数，用于静态类或类的静态成员的初始化。与实例构造函数不同，静态构造函数是自动调用的，它在类的静态成员被访问之前执行，只会被调用一次。

### 1. 定义静态构造函数

静态构造函数与实例构造函数的主要区别在于：

- 静态构造函数没有访问修饰符。
- 静态构造函数不接受参数。
- 静态构造函数只能在类首次被使用时调用。

静态构造函数的定义方式如下：

```csharp
public class Database
{
    public static string ConnectionString;

    // 静态构造函数
    static Database()
    {
        // 初始化静态成员
        Console.WriteLine("静态构造函数被调用");
        ConnectionString = "Server=myServer;Database=myDB;User=myUser;Password=myPassword;";
    }
}
```

### 2. 静态构造函数的特点

- **自动调用**：静态构造函数由运行时在类的任何静态成员被访问时自动调用，无需显式调用。
  
- **只调用一次**：静态构造函数只会在类的静态成员首次被访问时执行一次。无论访问多少次，静态构造函数都不会被重新调用。

- **无法直接调用**：你不能显式地调用静态构造函数，它由 CLR（公共语言运行时）在需要的时候自动调用。

- **线程安全**：静态构造函数由 CLR 确保是线程安全的。这意味着如果多个线程同时访问类的静态成员，静态构造函数不会被并发调用。

### 3. 使用静态构造函数

静态构造函数通常用于初始化静态成员或进行其他只需要执行一次的操作。例如，在配置类中，我们可能只需要一次性加载数据库连接字符串、设置配置项等。

```csharp
public class Logger
{
    public static string LogFilePath;

    // 静态构造函数
    static Logger()
    {
        Console.WriteLine("Logger 静态构造函数被调用");
        LogFilePath = "/var/log/application.log";
    }

    public static void Log(string message)
    {
        Console.WriteLine($"Log message: {message} (Log file: {LogFilePath})");
    }
}

class Program
{
    static void Main(string[] args)
    {
        // 静态构造函数在访问静态成员时自动调用
        Logger.Log("Application started.");
    }
}
```

输出：

```
Logger 静态构造函数被调用
Log message: Application started. (Log file: /var/log/application.log)
```

### 4. 静态构造函数与实例构造函数的区别

| 特性                 | 静态构造函数                              | 实例构造函数                            |
|----------------------|-------------------------------------------|----------------------------------------|
| 是否接受参数         | 不接受参数                                | 可以接受参数                          |
| 是否可以被调用       | 由 CLR 自动调用                           | 需要通过 `new` 关键字显式调用         |
| 是否多次调用         | 只调用一次，且在类的任何静态成员首次访问时调用 | 每次创建对象时都会调用                 |
| 是否能有访问修饰符   | 不能有访问修饰符                          | 可以有访问修饰符（如 `public`、`private`） |
| 作用范围             | 仅用于静态成员初始化                      | 用于初始化实例成员                    |

### 5. 静态构造函数的执行顺序

静态构造函数的执行顺序是由 CLR 控制的。它在以下情况下执行：

- 当类的静态成员首次被访问时，静态构造函数会被调用。
- 如果类的静态成员已经被访问过，那么静态构造函数不会再次执行。
- 如果类包含多个静态成员，静态构造函数也只会执行一次，即使这些成员被访问多次。

### 6. 静态构造函数的限制

- 静态构造函数不能有访问修饰符（例如 `public` 或 `private`），它始终是 `private` 的。
- 静态构造函数不能接受参数，因此不能通过构造函数传递数据。
- 静态构造函数无法在其他地方显式调用，它只能由 CLR 在适当的时候自动调用。

### 7. 静态构造函数的常见使用场景

- **初始化配置**：静态构造函数可以用来初始化全局配置或常量值，例如数据库连接、日志文件路径等。
- **资源清理**：静态构造函数可以执行一次性的资源清理工作，尤其是在静态类的生命周期结束时。
- **线程安全**：静态构造函数的执行顺序由 CLR 控制，因此可以用于确保某些线程安全的初始化操作。

---
